
# ğŸ“š Documentation Progressive - Alpha Laundry

Ce fichier regroupe la documentation de rÃ©fÃ©rence pour chaque feature majeure du projet, en reliant les fichiers backend et frontend, leur rÃ´le, et les subtilitÃ©s d'implÃ©mentation. Il est enrichi au fur et Ã  mesure de l'analyse des features.

---

## 1. Authentification / Login (Admin)

### Description
Permet Ã  un administrateur de se connecter Ã  lâ€™espace admin via email et mot de passe. La logique inclut la vÃ©rification des identifiants, la gestion du token JWT, la sauvegarde de la session, et la navigation conditionnelle selon le rÃ´le.

### Fichiers Frontend
- **Ã‰crans**
  - `frontend/mobile/admin-dashboard/lib/screens/auth/admin_login_screen.dart` : UI du formulaire de login, gestion des champs email/mot de passe, appel au contrÃ´leur dâ€™authentification.
- **ContrÃ´leurs**
  - `frontend/mobile/admin-dashboard/lib/controllers/auth_controller.dart` : Logique de connexion, gestion de lâ€™Ã©tat utilisateur, navigation, appel au service dâ€™authentification.
- **Services**
  - `frontend/mobile/admin-dashboard/lib/services/auth_service.dart` : RequÃªte HTTP vers `/auth/admin/login`, gestion du token et de lâ€™utilisateur en local (GetStorage).
- **ModÃ¨les**
  - `frontend/mobile/admin-dashboard/lib/models/user.dart` : Structure du modÃ¨le utilisateur (id, email, rÃ´le, etc.).
- **Middleware & Routes**
  - `frontend/mobile/admin-dashboard/lib/middleware/auth_middleware.dart` : VÃ©rifie lâ€™Ã©tat dâ€™authentification avant dâ€™accÃ©der Ã  une route protÃ©gÃ©e.

### Fichiers Backend
- **Routes**
  - `backend/src/routes/auth.routes.ts` : DÃ©finit `/admin/login` (POST), appelle le contrÃ´leur AuthController.
- **ContrÃ´leurs**
  - `backend/src/controllers/auth.controller.ts` : Logique de login : vÃ©rifie email/mot de passe, appelle AuthService, gÃ©nÃ¨re le token JWT.
- **Services**
  - `backend/src/services/auth.service.ts` : VÃ©rifie lâ€™utilisateur en base (Prisma), compare le mot de passe, gÃ©nÃ¨re le token JWT, retourne lâ€™utilisateur et le token.
- **ModÃ¨les**
  - `backend/src/models/types.ts` : Structure du modÃ¨le utilisateur, type UserRole.

### RÃ´le de chaque fichier
- **Frontend**
  - `admin_login_screen.dart` : Affiche le formulaire, gÃ¨re lâ€™UI et les interactions.
  - `auth_controller.dart` : GÃ¨re la logique de connexion, lâ€™Ã©tat utilisateur, la navigation.
  - `auth_service.dart` : Fait la requÃªte HTTP, stocke le token et lâ€™utilisateur.
  - `user.dart` : DÃ©finit le modÃ¨le utilisateur.
  - `auth_middleware.dart` : ProtÃ¨ge les routes, redirige si non authentifiÃ©.
- **Backend**
  - `auth.routes.ts` : Route dâ€™API pour le login admin.
  - `auth.controller.ts` : Logique de login, validation, gÃ©nÃ©ration du token.
  - `auth.service.ts` : AccÃ¨s Ã  la base, vÃ©rification, gÃ©nÃ©ration du token.
  - `types.ts` : ModÃ¨le utilisateur et rÃ´les.

### SchÃ©ma dâ€™interaction
1. **Frontend** : Lâ€™admin saisit email/mot de passe â†’ `auth_controller` appelle `auth_service` â†’ requÃªte POST `/auth/admin/login`.
2. **Backend** : Route `/admin/login` â†’ `AuthController.login` â†’ `AuthService.login` â†’ vÃ©rification en base â†’ gÃ©nÃ©ration du token â†’ rÃ©ponse avec user + token.
3. **Frontend** : Stockage du token et de lâ€™utilisateur â†’ navigation vers dashboard si succÃ¨s.

### Conseils pour la navigation rapide
- Pour comprendre la logique de login, commence par le formulaire (`admin_login_screen.dart`), puis la logique (`auth_controller.dart`), puis le service (`auth_service.dart`).
- Pour le backend, commence par la route (`auth.routes.ts`), puis le contrÃ´leur (`auth.controller.ts`), puis le service (`auth.service.ts`).
- Le modÃ¨le utilisateur est dÃ©fini dans `user.dart` (frontend) et `types.ts` (backend).

---


## 2. Gestion des Utilisateurs (User)

### Description
Permet de gÃ©rer les utilisateurs du systÃ¨me (clients, affiliÃ©s, admins, livreurs) : crÃ©ation, Ã©dition, suppression, affichage des dÃ©tails, statistiques, filtrage et recherche. La logique inclut la gestion des rÃ´les, des adresses, des statistiques, et lâ€™interaction avec le backend pour toutes les opÃ©rations CRUD.

### Fichiers Frontend

- **Ã‰crans**
  - `frontend/mobile/admin-dashboard/lib/screens/users/users_screen.dart`  : Ã‰cran principal de gestion des utilisateurs (table, stats, filtres, crÃ©ation, Ã©dition, dÃ©tails).
  - `components/users_table.dart`  : Table dâ€™affichage des utilisateurs.
  - `components/user_create_dialog.dart`  : Dialog de crÃ©ation dâ€™utilisateur.
  - `components/user_edit_dialog.dart`  : Dialog dâ€™Ã©dition dâ€™utilisateur.
  - `components/user_details_dialog.dart`  : Dialog dâ€™affichage des dÃ©tails dâ€™un utilisateur.
  - `components/user_stats_grid.dart`  : Affichage des statistiques utilisateurs.

- **ContrÃ´leurs**
  - `frontend/mobile/admin-dashboard/lib/controllers/users_controller.dart`  : Logique de gestion des utilisateurs : chargement, crÃ©ation, Ã©dition, suppression, stats, filtres.

- **Services**
  - `frontend/mobile/admin-dashboard/lib/services/user_service.dart`  : RequÃªtes HTTP vers `/api/users` pour toutes les opÃ©rations CRUD, gestion de la pagination, filtrage, recherche.

- **ModÃ¨les**
  - `frontend/mobile/admin-dashboard/lib/models/user.dart`  : Structure du modÃ¨le utilisateur (id, email, rÃ´le, prÃ©nom, nom, tÃ©lÃ©phone, etc.).

### Fichiers Backend

- **Routes**
  - `backend/src/routes/user.routes.ts`  : DÃ©finit toutes les routes `/api/users` (GET, POST, PUT, DELETE, dÃ©tails, etc.), protection par token et rÃ´le.

- **ContrÃ´leurs**
  - `backend/src/controllers/user.controller.ts`  : Logique de gestion des utilisateurs : crÃ©ation, Ã©dition, suppression, rÃ©cupÃ©ration des dÃ©tails, stats, etc.

- **Services**
  - `backend/src/services/auth.service.ts`  : CrÃ©ation dâ€™utilisateur (register), gestion des rÃ´les, hash du mot de passe.
  - `backend/src/services/user.service.ts`  : (Si prÃ©sent) Logique mÃ©tier avancÃ©e pour les utilisateurs (recherche, stats, etc.).

- **ModÃ¨les**
  - `backend/src/models/types.ts`  : Structure du modÃ¨le utilisateur, type UserRole, UserListResponse, UserStats, UserFilters.

### RÃ´le de chaque fichier

- **Frontend**
  - `users_screen.dart` : UI principale, navigation, gestion des interactions.
  - `users_controller.dart` : Logique mÃ©tier, gestion dâ€™Ã©tat, appels aux services.
  - `user_service.dart` : Communication avec lâ€™API backend.
  - `user.dart` : ModÃ¨le utilisateur.
  - `users_table.dart`, `user_create_dialog.dart`, `user_edit_dialog.dart`, `user_details_dialog.dart`, `user_stats_grid.dart` : Composants UI spÃ©cialisÃ©s.

- **Backend**
  - `user.routes.ts` : DÃ©finition des endpoints API.
  - `user.controller.ts` : Logique mÃ©tier, validation, gestion des rÃ©ponses.
  - `auth.service.ts` : CrÃ©ation dâ€™utilisateur, gestion des rÃ´les.
  - `types.ts` : ModÃ¨le utilisateur, types de rÃ©ponses et filtres.

### SchÃ©ma dâ€™interaction

1. **Frontend** : Lâ€™utilisateur admin navigue sur lâ€™Ã©cran Users â†’ le contrÃ´leur charge la liste via `user_service` â†’ requÃªte GET `/api/users`.
2. **Backend** : Route `/api/users` â†’ `UserController` â†’ rÃ©cupÃ©ration en base, filtrage, pagination â†’ rÃ©ponse avec la liste.
3. **Frontend** : CrÃ©ation/Ã©dition/suppression via dialogs â†’ requÃªtes POST/PUT/DELETE â†’ mise Ã  jour de la liste.
4. **Backend** : Validation, crÃ©ation/modification/suppression en base, rÃ©ponse avec succÃ¨s ou erreur.

### Conseils pour la navigation rapide

- Pour comprendre la gestion des utilisateurs, commence par lâ€™Ã©cran (`users_screen.dart`), puis le contrÃ´leur (`users_controller.dart`), puis le service (`user_service.dart`).
- Pour le backend, commence par la route (`user.routes.ts`), puis le contrÃ´leur (`user.controller.ts`), puis le service (`auth.service.ts` ou `user.service.ts`).
- Le modÃ¨le utilisateur est dÃ©fini dans `user.dart` (frontend) et `types.ts` (backend).

---

## 3. Gestion des Commandes (Order)

### Description
Permet de gÃ©rer les commandes du systÃ¨me : crÃ©ation, Ã©dition, suppression, affichage des dÃ©tails, recherche avancÃ©e, filtrage par statut, utilisateur, date, etc. La logique inclut la gestion des items, du statut, du paiement, de lâ€™archivage, et lâ€™interaction avec le backend pour toutes les opÃ©rations CRUD et de reporting.

### Fichiers Frontend

- **Ã‰crans**
  - `frontend/mobile/admin-dashboard/lib/screens/orders/orders_screen.dart`  : Ã‰cran principal de gestion des commandes (table, filtres, recherche, dÃ©tails, pagination).
  - `components/orders_table.dart`  : Table dâ€™affichage des commandes.
  - `components/order_details_dialog.dart`  : Dialog dâ€™affichage des dÃ©tails dâ€™une commande.
  - `components/order_filters.dart`, `components/advanced_search_filter.dart`, `components/orders_header.dart`  : Filtres, header, recherche avancÃ©e.

- **ContrÃ´leurs**
  - `frontend/mobile/admin-dashboard/lib/controllers/orders_controller.dart`  : Logique de gestion des commandes : chargement, crÃ©ation, Ã©dition, suppression, stats, filtres, sÃ©lection, pagination.

- **Services**
  - `frontend/mobile/admin-dashboard/lib/services/order_service.dart`  : RequÃªtes HTTP vers `/api/orders` pour toutes les opÃ©rations CRUD, gestion de la pagination, filtrage, recherche, archivage.

- **ModÃ¨les**
  - `frontend/mobile/admin-dashboard/lib/models/order.dart`  : Structure du modÃ¨le commande (id, user, items, statut, paiement, etc.).
  - `frontend/mobile/admin-dashboard/lib/models/orders_page_data.dart`  : Structure pour la pagination et les donnÃ©es de page.

### Fichiers Backend

- **Routes**
  - `backend/src/routes/order.routes.ts`  : DÃ©finit toutes les routes `/api/orders` (GET, POST, PATCH, DELETE, recherche, dÃ©tails, archivage, etc.), protection par token et rÃ´le.

- **ContrÃ´leurs**
  - `backend/src/controllers/order.controller/index.ts`  : Logique de gestion des commandes : crÃ©ation, Ã©dition, suppression, rÃ©cupÃ©ration des dÃ©tails, stats, etc.
  - `backend/src/controllers/order.controller/orderQuery.controller.ts`  : Logique de recherche, pagination, dÃ©tails, reporting.

- **Services**
  - `backend/src/services/order.service/orderQuery.service.ts`  : Logique mÃ©tier avancÃ©e pour les commandes (recherche, stats, pagination, reporting).

- **ModÃ¨les**
  - `backend/src/models/types.ts`  : Structure du modÃ¨le commande, types de rÃ©ponses et filtres.

### RÃ´le de chaque fichier

- **Frontend**
  - `orders_screen.dart` : UI principale, navigation, gestion des interactions.
  - `orders_controller.dart` : Logique mÃ©tier, gestion dâ€™Ã©tat, appels aux services.
  - `order_service.dart` : Communication avec lâ€™API backend.
  - `order.dart`, `orders_page_data.dart` : ModÃ¨les de commande et pagination.
  - `orders_table.dart`, `order_details_dialog.dart`, `order_filters.dart`, `advanced_search_filter.dart`, `orders_header.dart` : Composants UI spÃ©cialisÃ©s.

- **Backend**
  - `order.routes.ts` : DÃ©finition des endpoints API.
  - `order.controller/index.ts` : Logique mÃ©tier, validation, gestion des rÃ©ponses.
  - `order.controller/orderQuery.controller.ts` : Recherche, pagination, reporting.
  - `order.service/orderQuery.service.ts` : Logique mÃ©tier avancÃ©e.
  - `types.ts` : ModÃ¨le commande, types de rÃ©ponses et filtres.

### SchÃ©ma dâ€™interaction

1. **Frontend** : Lâ€™utilisateur admin navigue sur lâ€™Ã©cran Orders â†’ le contrÃ´leur charge la liste via `order_service` â†’ requÃªte GET `/api/orders`.
2. **Backend** : Route `/api/orders` â†’ `OrderController` â†’ rÃ©cupÃ©ration en base, filtrage, pagination â†’ rÃ©ponse avec la liste.
3. **Frontend** : CrÃ©ation/Ã©dition/suppression via dialogs â†’ requÃªtes POST/PATCH/DELETE â†’ mise Ã  jour de la liste.
4. **Backend** : Validation, crÃ©ation/modification/suppression en base, rÃ©ponse avec succÃ¨s ou erreur.

### Conseils pour la navigation rapide

- Pour comprendre la gestion des commandes, commence par lâ€™Ã©cran (`orders_screen.dart`), puis le contrÃ´leur (`orders_controller.dart`), puis le service (`order_service.dart`).
- Pour le backend, commence par la route (`order.routes.ts`), puis le contrÃ´leur (`order.controller/index.ts`), puis le service (`order.service/orderQuery.service.ts`).
- Le modÃ¨le commande est dÃ©fini dans `order.dart` (frontend) et `types.ts` (backend).


---

### Feature: Adresse (Address)

#### **Backend**

- **Controller:**  
  - `src/controllers/address.controller.ts`  
    Handles address-related endpoints, e.g. updating the address of an order (`PATCH /orders/:orderId/address`).  
    - Verifies user permissions and address ownership.
    - Updates the order's address in the database.

- **Service:**  
  - `src/services/address.service.ts`  
    Contains business logic for address management:
    - `getAddressById(addressId)`: Fetches address details.
    - `createAddress(...)`: Creates a new address, manages default address logic.

- **Model/Types:**  
  - `src/models/types.ts`  
    Defines the `Address` interface:
    ```typescript
    ```

#### **Frontend (Mobile Admin Dashboard)**

- **Controller:**  
  - `lib/controllers/address_controller.dart`  
    Manages address state and operations:
    - Loads addresses, handles errors.
    - Calls service methods for CRUD operations.

- **Service:**  
  - `lib/services/address_service.dart`  
    Handles API calls:
    - `getAddresses()`, `getAddressById(id)`, `createAddress(data)`, etc.
    - Communicates with backend `/api/addresses` endpoints.

- **Model:**  
  - `lib/models/address.dart`  
    Dart class representing an address, with fields matching backend model.

#### **Schema of Interaction**

- **Frontend** calls service methods to fetch, create, or update addresses.
- **Service** sends HTTP requests to backend endpoints (`/api/addresses`, `/api/orders/:orderId/address`).
- **Backend Controller** validates requests, checks permissions, and delegates to the service.
- **Backend Service** interacts with the database via Prisma, returns address data.
- **Frontend Controller** updates UI state based on service responses.

#### **Navigation Tips**

- To trace address creation:  
  - Frontend: `address_controller.dart` â†’ `address_service.dart` â†’ `/api/addresses`  
  - Backend: `address.controller.ts` â†’ `address.service.ts` â†’ Prisma

- To trace address update for an order:  
  - Frontend: `address_controller.dart` â†’ `address_service.dart` â†’ `/api/orders/:orderId/address`  
  - Backend: `address.controller.ts` (method: `updateOrderAddress`) â†’ Prisma

---

> Ce fichier sera enrichi Ã  chaque nouvelle feature analysÃ©e pour servir de rÃ©fÃ©rence complÃ¨te Ã  toute lâ€™Ã©quipe.


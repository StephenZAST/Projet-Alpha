[build]
command = "npm ci --include=dev && npm run build"
publish = "out"

[build.environment]
NODE_VERSION = "18"
NODE_ENV = "production"
NEXT_PUBLIC_API_URL = "https://alpha-laundry-backend.onrender.com"

# Redirects vers les autres applications
[[redirects]]
from = "/admin"
to = "https://68f95b5655b078000891a633--alphalaundry.netlify.app/"
status = 301

[[redirects]]
from = "/affiliate"
to = "https://68fac0ae8f30bef299f38200--affiliatealpha.netlify.app/"
status = 301

[[redirects]]
from = "/delivery"
to = "https://68fac646f8312f00079c8b17--alphalaundrydelivers.netlify.app/"
status = 301

# Règle de redirection pour SPA - Redirige les routes non trouvées vers index.html
[[redirects]]
from = "/*"
to = "/index.html"
status = 200

[[headers]]
for = "/*"
[headers.values]
X-Content-Type-Options = "nosniff"
X-Frame-Options = "SAMEORIGIN"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "camera=(), microphone=(), geolocation=()"

# Cache headers pour les assets statiques
[[headers]]
for = "/_next/static/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/images/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"
